import{S as ce,i as pe,s as ue,e as s,t as e,k as he,c as n,a as r,g as a,d as o,n as de,b as i,f as fe,I as t,W as xt}from"./vendor-9aac3077.js";function ge(re){let l,A,f,X,L,Z,p,tt,g,et,at,N,ot,st,G,k,nt,m,rt,x,lt,it,O,le=`<code class="language-javascript"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">URL</span> <span class="token operator">=</span>
  <span class="token string">'https://api.github.com/repos/reuters-graphics/&lt;YOUR REPO>/actions/workflows/publish.yaml/dispatches'</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
    <span class="token constant">URL</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      ref<span class="token operator">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      headers<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        Accept<span class="token operator">:</span> <span class="token string">'application/vnd.github.v3+json'</span><span class="token punctuation">,</span>
        Authorization<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">token </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WORKFLOW_AUTH_TOKEN</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`,d,ct,S,pt,ut,C,ht,j,y,dt,v,ft,D,gt,kt,T,_,mt,u,yt,Y,vt,_t,K,bt,Et,P,b,wt,M,At,W,Gt,E,w,Ot,U,jt,Tt,Pt,h,Rt,F,Ht,It,q,Lt,Nt;return{c(){l=s("section"),A=s("h1"),f=s("a"),X=e("Automating publishing"),L=s("p"),Z=e("This graphics kit can publish projects to our RNGS server using GitHub Actions."),p=s("p"),tt=e("To set your project up for automated publishing, make sure your repo is located in the "),g=s("a"),et=e("Reuters Graphics Github org"),at=e(" then move and uncomment the YAML file at "),N=s("code"),ot=e(".github/publish.yaml"),st=e(" and further configure the publishing conditions per the comments in that file."),G=s("h2"),k=s("a"),nt=e("Publishing from a script"),m=s("p"),rt=e("If you\u2019re triggering your publish job by hitting a GitHub API for your workflow, i.e., "),x=s("code"),lt=e("on: workflow_dispatch"),it=e(", you can follow the following example in Node:"),O=s("pre"),d=s("p"),ct=e("Your "),S=s("code"),pt=e("WORKFLOW_AUTH_TOKEN"),ut=e(" in the above example should be a GitHub personal access token with write access to the project repo. "),C=s("strong"),ht=e("Make sure you treat this token as a secret in your repositories."),j=s("h2"),y=s("a"),dt=e("Metadata"),v=s("p"),ft=e("All metadata for your project "),D=s("strong"),gt=e("must"),kt=e(" already be filled in before automatically publishing in GitHub actions. The easiest way to ensure it is is to upload your project to RNGS locally first, which will trigger prompts for any missing metadata."),T=s("h2"),_=s("a"),mt=e("Google auth"),u=s("p"),yt=e("If you\u2019re going to run "),Y=s("code"),vt=e("get-google"),_t=e(" as part of your workflow you\u2019ll need to add the Google credentials file to your repo and set the "),K=s("code"),bt=e("GOOGLE_APPLICATION_CREDENTIALS_PATH"),Et=e(" environment variable in your workflow config to the path to that file (relative to the root of your project). You can get our Google credentials file from the team 1password account."),P=s("h4"),b=s("a"),wt=e("\u{1F512} Security"),M=s("p"),At=e("Google credentials are a secret and must be handled sensitively when added to your project."),W=s("p"),Gt=e("You must:"),E=s("ol"),w=s("li"),Ot=e("Keep your project repo "),U=s("strong"),jt=e("PRIVATE"),Tt=e("."),Pt=he(),h=s("li"),Rt=e("Add a "),F=s("code"),Ht=e("secret"),It=e(" suffix to the Google credentials file in your project, e.g., "),q=s("code"),Lt=e("google-creds.secret.json"),Nt=e(", which will exclude this file when the project archive is made for clients."),this.h()},l(V){l=n(V,"SECTION",{class:!0});var c=r(l);A=n(c,"H1",{id:!0});var St=r(A);f=n(St,"A",{class:!0,href:!0});var Ct=r(f);X=a(Ct,"Automating publishing"),Ct.forEach(o),St.forEach(o),L=n(c,"P",{});var Dt=r(L);Z=a(Dt,"This graphics kit can publish projects to our RNGS server using GitHub Actions."),Dt.forEach(o),p=n(c,"P",{});var R=r(p);tt=a(R,"To set your project up for automated publishing, make sure your repo is located in the "),g=n(R,"A",{href:!0,rel:!0});var Yt=r(g);et=a(Yt,"Reuters Graphics Github org"),Yt.forEach(o),at=a(R," then move and uncomment the YAML file at "),N=n(R,"CODE",{});var Kt=r(N);ot=a(Kt,".github/publish.yaml"),Kt.forEach(o),st=a(R," and further configure the publishing conditions per the comments in that file."),R.forEach(o),G=n(c,"H2",{id:!0});var Mt=r(G);k=n(Mt,"A",{class:!0,href:!0});var Wt=r(k);nt=a(Wt,"Publishing from a script"),Wt.forEach(o),Mt.forEach(o),m=n(c,"P",{});var $=r(m);rt=a($,"If you\u2019re triggering your publish job by hitting a GitHub API for your workflow, i.e., "),x=n($,"CODE",{});var Ut=r(x);lt=a(Ut,"on: workflow_dispatch"),Ut.forEach(o),it=a($,", you can follow the following example in Node:"),$.forEach(o),O=n(c,"PRE",{class:!0});var ie=r(O);ie.forEach(o),d=n(c,"P",{});var z=r(d);ct=a(z,"Your "),S=n(z,"CODE",{});var Ft=r(S);pt=a(Ft,"WORKFLOW_AUTH_TOKEN"),Ft.forEach(o),ut=a(z," in the above example should be a GitHub personal access token with write access to the project repo. "),C=n(z,"STRONG",{});var qt=r(C);ht=a(qt,"Make sure you treat this token as a secret in your repositories."),qt.forEach(o),z.forEach(o),j=n(c,"H2",{id:!0});var Vt=r(j);y=n(Vt,"A",{class:!0,href:!0});var zt=r(y);dt=a(zt,"Metadata"),zt.forEach(o),Vt.forEach(o),v=n(c,"P",{});var B=r(v);ft=a(B,"All metadata for your project "),D=n(B,"STRONG",{});var $t=r(D);gt=a($t,"must"),$t.forEach(o),kt=a(B," already be filled in before automatically publishing in GitHub actions. The easiest way to ensure it is is to upload your project to RNGS locally first, which will trigger prompts for any missing metadata."),B.forEach(o),T=n(c,"H2",{id:!0});var Bt=r(T);_=n(Bt,"A",{class:!0,href:!0});var Jt=r(_);mt=a(Jt,"Google auth"),Jt.forEach(o),Bt.forEach(o),u=n(c,"P",{});var H=r(u);yt=a(H,"If you\u2019re going to run "),Y=n(H,"CODE",{});var Qt=r(Y);vt=a(Qt,"get-google"),Qt.forEach(o),_t=a(H," as part of your workflow you\u2019ll need to add the Google credentials file to your repo and set the "),K=n(H,"CODE",{});var Xt=r(K);bt=a(Xt,"GOOGLE_APPLICATION_CREDENTIALS_PATH"),Xt.forEach(o),Et=a(H," environment variable in your workflow config to the path to that file (relative to the root of your project). You can get our Google credentials file from the team 1password account."),H.forEach(o),P=n(c,"H4",{id:!0});var Zt=r(P);b=n(Zt,"A",{class:!0,href:!0});var te=r(b);wt=a(te,"\u{1F512} Security"),te.forEach(o),Zt.forEach(o),M=n(c,"P",{});var ee=r(M);At=a(ee,"Google credentials are a secret and must be handled sensitively when added to your project."),ee.forEach(o),W=n(c,"P",{});var ae=r(W);Gt=a(ae,"You must:"),ae.forEach(o),E=n(c,"OL",{});var J=r(E);w=n(J,"LI",{});var Q=r(w);Ot=a(Q,"Keep your project repo "),U=n(Q,"STRONG",{});var oe=r(U);jt=a(oe,"PRIVATE"),oe.forEach(o),Tt=a(Q,"."),Q.forEach(o),Pt=de(J),h=n(J,"LI",{});var I=r(h);Rt=a(I,"Add a "),F=n(I,"CODE",{});var se=r(F);Ht=a(se,"secret"),se.forEach(o),It=a(I," suffix to the Google credentials file in your project, e.g., "),q=n(I,"CODE",{});var ne=r(q);Lt=a(ne,"google-creds.secret.json"),ne.forEach(o),Nt=a(I,", which will exclude this file when the project archive is made for clients."),I.forEach(o),J.forEach(o),c.forEach(o),this.h()},h(){i(f,"class","heading-link"),i(f,"href","#automating-publishing"),i(A,"id","automating-publishing"),i(g,"href","https://github.com/reuters-graphics"),i(g,"rel","nofollow"),i(k,"class","heading-link"),i(k,"href","#publishing-from-a-script"),i(G,"id","publishing-from-a-script"),i(O,"class","language-javascript"),i(y,"class","heading-link"),i(y,"href","#metadata"),i(j,"id","metadata"),i(_,"class","heading-link"),i(_,"href","#google-auth"),i(T,"id","google-auth"),i(b,"class","heading-link"),i(b,"href","#-security"),i(P,"id","-security"),i(l,"class","wide")},m(V,c){fe(V,l,c),t(l,A),t(A,f),t(f,X),t(l,L),t(L,Z),t(l,p),t(p,tt),t(p,g),t(g,et),t(p,at),t(p,N),t(N,ot),t(p,st),t(l,G),t(G,k),t(k,nt),t(l,m),t(m,rt),t(m,x),t(x,lt),t(m,it),t(l,O),O.innerHTML=le,t(l,d),t(d,ct),t(d,S),t(S,pt),t(d,ut),t(d,C),t(C,ht),t(l,j),t(j,y),t(y,dt),t(l,v),t(v,ft),t(v,D),t(D,gt),t(v,kt),t(l,T),t(T,_),t(_,mt),t(l,u),t(u,yt),t(u,Y),t(Y,vt),t(u,_t),t(u,K),t(K,bt),t(u,Et),t(l,P),t(P,b),t(b,wt),t(l,M),t(M,At),t(l,W),t(W,Gt),t(l,E),t(E,w),t(w,Ot),t(w,U),t(U,jt),t(w,Tt),t(E,Pt),t(E,h),t(h,Rt),t(h,F),t(F,Ht),t(h,It),t(h,q),t(q,Lt),t(h,Nt)},p:xt,i:xt,o:xt,d(V){V&&o(l)}}}const me={title:"Automated publishing",published:!0,order:19};class ye extends ce{constructor(l){super();pe(this,l,null,ge,ue,{})}}export{ye as default,me as metadata};
